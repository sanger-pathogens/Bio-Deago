language: perl
sudo: true

addons:
  apt:
    packages:
    - r-base 
    - r-base-dev

perl:
  - "5.14"

pandoc_version: 1.16

install:
  - wget https://cran.r-project.org/src/base/R-3/R-3.4.0.tar.gz 
  - tar -xvf R-3.4.0.tar.gz
  - pushd R-3.4.0 && ./configure --with-readline=no --with-x --with-cairo --prefix=/usr && make && sudo make install && popd
  - sudo Rscript -e "install.packages(c('DT', 'ggplot2', 'ggrepel', 'markdown', 'Matrix', 'reshape', 'rmarkdown', 'scales', 'XML'), repos='http://mirrors.ebi.ac.uk/CRAN/')"
  - sudo Rscript -e "source('http://bioconductor.org/biocLite.R')" -e "biocLite(c('GenomicRanges', 'graph', 'limma', 'SummarizedExperiment', 'S4Vectors'))"
  - sudo Rscript -e "source('http://bioconductor.org/biocLite.R')" -e "biocLite(c('DESeq2', 'topGO'))"
  - git clone --branch v1.0.1 https://github.com/vaofford/deago.git
  - pushd deago && git archive --format=tar.gz --prefix=deago-1.0.1/ v1.0.1 >deago-1.0.1.tar.gz && popd
  - pushd deago && sudo Rscript -e "install.packages('deago-1.0.1.tar.gz', repos = NULL, type='source')" && popd

cache:
  directories:
    - ~/build/vaofford/Bio-Deago/R-3.4.0
  apt: true

before_script:
  - "export DISPLAY=:99.0"
  - "sh -e /etc/init.d/xvfb start"
  - sleep 3 # give xvfb some time to start

script:
  - "Rscript -e 'capabilities()'"
  - "dzil authordeps --missing | cpanm --notest"
  - "dzil listdeps --missing | cpanm --notest"
  - "perl t/Bio/Deago/CommandLine/Deago.t" 
  - "ls"
  - "cat deago.rlog"
